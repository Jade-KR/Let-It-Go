# Lego Master - AI & IoT 기반 레고 분류기

## 서비스 개요

Lego Master는 AI와 IoT를 활용하여 레고를 자동으로 분류해 내 보유 인벤토리에 추가를 해 주는 솔루션입니다.

현재 Lego Master는 수동으로 부품을 공급해 줘야 하지만 추후 이를 개선하면 레고의 공급까지 자동화로 유저는 단지 레고를 Lego Master에 쏟아붓는것 만으로 내가 어떤 레고 부품을 가지고 있는지 한번에 파악할 수 있게 됩니다.

## 핵심 기능 및 기대 효과

내가 보유한 레고를 직접 입력하지 않아도 기계가 알아서 분류하여 내 인벤토리에 추가해 줍니다. 사용자는 이를 바탕으로 내가 보유한 부품으로 어떤 설계도를 제작할 수 있는지, 필요한 부품은 어떤 것인지 알 수 있습니다.

사용자는 창작에만 신경 쓸 수 있어 더욱 풍요로운 취미 생활을 즐길 수 있습니다.

## 준비물

- 레고를 이송시킬 수 있는 컨베이어 벨트(스텝의 제어가 가능해야 함)
- 분류된 레고를 원하는 방향으로 보낼 수 있도록 방향을 제어할 수 있는 이송장치
- 레이저 모듈
- 조도센서
- Picamera V2(레고 부품을 촬영하기 위함)
- 조명(이미지가 외부 조건에 영향받지 않게 하기 위하여 외부의 빛을 차단하기 때문에 추가로 빛을 공급할 장치가 필요함)

## 작동 과정 - Arduino UNO

1. LegoMaster의 컨베이어벨트에 레고 부품이 공급됩니다.
2. 레고 부품이 이송되면서 레이저를 가리게 되고 조도센서는 빛의 밝기 변화를 통해 센서 값이 변합니다.
3. Arduino UNO는 조도센서값의 변화로 물체가 들어왔음을 인식합니다.
4. 물체가 촬영되기 적절한 위치까지 갈 수 있도록 go_to_camera 큐에 필요한 스텝(스텝모터의 스텝 수)을 삽입합니다.
5. 레고 부품이 촬영하기 적절한 위치에 도달합니다.(go_to_camera의 front가 0이 되는 순간)
   1. go_to_camera에서 deque를 수행합니다.
   2. raspberry pi에 적절한 위치에 레고부품이 도달했다는 신호를 보냅니다.
   3. 1초간 기다린 후 떨어지기 직전  위치까지 갈 수 있도록 go_to_confirm 큐에 필요한 스텝을 삽입합니다
6. 레고 부품이 떨어지기 직전 위치에 도달합니다.(go_to_confirm의 front가 0이 되는 순간)
   1. go_to_confirm에서 deque를 수행합니다.
   2. 라즈베리파이로부터의 입력이 있는지 확인합니다.
      1. 입력된 방향으로 스텝모터의 분류기를 이동시킵니다.
7. 레고 부품이 분류되어 나옵니다.

## 작동 과정 - Raspberry pi

1. 로그인을 합니다.
2. 로그인이 되면 Arduino UNO로부터 신호를 받을 준비를 합니다.
3. Arduino UNO로부터 신호가 들어오면 pi-camera로 촬영을 수행합니다.
4. 촬영한 이미지를 레고 디텍터에 입력하여 레고 부품부분 이미지를 얻어냅니다.
5. 잘라낸 레고 부품을 미리 학습시킨 keras 모델에 입력합니다.
6. keras 모델로부터 얻어진 index값을 레고부품의 part_id로 변환합니다.
7. 식별된 part_id를 서버로 전송하여 유저의 임시 인벤토리에 추가시키는 요청을 보냅니다.

## 레고 디텍터

레고 디텍터는 카메라로부터 얻어진 이미지를 케라스 모델에 입력으로 사용할 수 있도록 레고 부품부분만 잘라내 주는 작업을 수행합니다.

### 레고 디텍더 동작원리

[레고 디텍터 동작원리](object_detection/object_detection.md) 보러가기

## 레고 식별기

레고 식별기는 레고 디텍터로부터 적절하게 가공된 이미지를 입력으로 받아 이 부품이 어떤 부품인지 분류 하는 작업을 수행합니다.

### 레고 식별기 동작원리

[레고 식별기 동작원리](object_recognition/object_recognition.md) 보러가기